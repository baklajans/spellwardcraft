<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—Ä–∞—Ñ—Ç–∞ ‚Äî —Ä–µ–≤–µ–Ω—Ç—ã</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    body { background: radial-gradient(circle at 20% 20%, #0f172a, #020617); color: #e2e8f0; }
    .glass { backdrop-filter: blur(10px); background: rgba(15, 23, 42, 0.55); border: 1px solid rgba(148, 163, 184, 0.2); }
    .tag { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.06); }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-7xl mx-auto px-8 py-10 space-y-8">
    <header class="glass rounded-2xl p-6 shadow-xl">
      <div class="flex flex-col gap-4">
        <div>
          <p class="uppercase text-xs tracking-[0.3em] text-slate-400">Spellward Craft</p>
          <h1 class="text-3xl font-bold text-white mt-1">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—Ä–∞—Ñ—Ç–∞</h1>
          <p class="text-sm text-slate-300 mt-2">–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ü–µ–Ω—ã –±–∞–∑–æ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤, –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∫–æ—Ä–∑–∏–Ω—É, —Å—á–∏—Ç–∞–π—Ç–µ –∑–∞—Ç—Ä–∞—Ç—ã –∏ –∏—Ç–æ–≥ –≤ —Ä–µ–≤–µ–Ω—Ç–∞—Ö. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –≥–æ—Ç–æ–≤—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º.</p>
        </div>
      </div>
    </header>

    <section class="glass rounded-2xl p-5 space-y-4">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h2 class="text-xl font-semibold">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É</h2>
          <p class="text-sm text-slate-300">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –Ω–∞–π–¥–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏ —É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.</p>
        </div>
        <div class="flex flex-col gap-2 w-full md:w-auto">
          <div class="flex flex-wrap gap-2">
            <button data-addcat="all" class="add-cat-btn px-3 py-1 rounded-full text-sm bg-emerald-500 text-slate-900 font-semibold">–í—Å–µ</button>
            <button data-addcat="armor" class="add-cat-btn px-3 py-1 rounded-full text-sm bg-slate-800/70 text-slate-300">–ë—Ä–æ–Ω—è</button>
            <button data-addcat="weapon" class="add-cat-btn px-3 py-1 rounded-full text-sm bg-slate-800/70 text-slate-300">–û—Ä—É–∂–∏–µ</button>
            <button data-addcat="tool" class="add-cat-btn px-3 py-1 rounded-full text-sm bg-slate-800/70 text-slate-300">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
          </div>
          <div class="relative w-full md:w-72">
            <input id="addSearch" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é" class="w-full bg-slate-900/60 border border-slate-700 rounded-full px-4 py-2 pr-10 text-sm text-white">
            <span class="absolute right-3 top-2.5 text-slate-400">üîç</span>
          </div>
        </div>
      </div>
      <div id="addCards" class="grid sm:grid-cols-2 xl:grid-cols-3 gap-3"></div>
      <p class="text-xs text-slate-400">–ù–∞—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏.</p>
    </section>

    <section class="glass rounded-2xl p-6 space-y-4">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <h2 class="text-xl font-semibold">–ö–æ—Ä–∑–∏–Ω–∞</h2>
        <div class="flex items-center gap-4 flex-wrap">
          <div class="text-sm text-slate-300">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–µ–≤–µ–Ω—Ç–∞—Ö</div>
          <label class="flex items-center gap-2 text-sm text-slate-200 bg-slate-900/60 border border-slate-700 rounded-full px-3 py-1 shadow">
            <input id="roundUpToggle" type="checkbox" class="accent-emerald-500" checked>
            <span class="text-xs sm:text-sm">–û–∫—Ä—É–≥–ª—è—Ç—å —Ü–µ–Ω—É</span>
          </label>
        </div>
        <div class="glass rounded-xl p-4 flex flex-col gap-2 min-w-[240px]">
          <label class="text-xs text-slate-300 uppercase tracking-wide">–ù–∞—Ü–µ–Ω–∫–∞ –Ω–∞ –≥–æ—Ç–æ–≤–æ–µ –∏–∑–¥–µ–ª–∏–µ</label>
          <div class="flex items-center gap-3">
            <input id="markupInput" type="range" min="0" max="200" value="0" class="w-full">
            <input id="markupValue" type="number" min="0" max="500" value="0" class="w-16 text-right bg-slate-900/60 border border-slate-600 rounded px-2 py-1 text-sm">
            <span class="text-sm text-slate-300">%</span>
          </div>
          <p class="text-xs text-slate-400">–í–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –±—Ä–æ–Ω—é/–æ—Ä—É–∂–∏–µ/–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤ –æ—Å—Ç–∞—ë—Ç—Å—è –∏—Å—Ö–æ–¥–Ω–æ–π.</p>
        </div>
      </div>
      <div id="cartList" class="space-y-2"></div>
      <div class="grid md:grid-cols-3 gap-4">
        <div class="glass rounded-xl p-4 border border-emerald-400/40">
          <p class="text-xs text-slate-400 uppercase tracking-wide">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (–±–µ–∑ –Ω–∞—Ü–µ–Ω–∫–∏)</p>
          <p class="text-2xl font-bold" id="baseCost">0</p>
        </div>
        <div class="glass rounded-xl p-4 border border-amber-400/40">
          <p class="text-xs text-slate-400 uppercase tracking-wide">–ù–∞—Ü–µ–Ω–∫–∞</p>
          <p class="text-2xl font-bold" id="markupInfo">+0%</p>
        </div>
        <div class="glass rounded-xl p-4 border border-emerald-400/40">
          <p class="text-xs text-slate-400 uppercase tracking-wide">–ò—Ç–æ–≥ —Å –Ω–∞—Ü–µ–Ω–∫–æ–π</p>
          <p class="text-3xl font-extrabold text-emerald-300" id="finalCost">0</p>
        </div>
      </div>
      <div class="grid lg:grid-cols-2 gap-4">
        <div class="glass rounded-xl p-4 border border-slate-700">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">–ë–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã</h3>
            <span class="text-xs text-slate-400">—Ä–µ–≤–µ–Ω—Ç—ã ‚Üí —Ü–µ–Ω–∞, —à—Ç—É–∫–∏ ‚Üí –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</span>
          </div>
          <div id="baseSummary" class="mt-3 text-sm"></div>
        </div>
        <div class="glass rounded-xl p-4 border border-slate-700">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</h3>
            <span class="text-xs text-slate-400">–±–µ–∑ –Ω–∞—Ü–µ–Ω–∫–∏</span>
          </div>
          <div id="interSummary" class="mt-3 text-sm"></div>
        </div>
      </div>
    </section>

    <section class="glass rounded-2xl p-6 space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">–ö–∞—Ç–∞–ª–æ–≥</h2>
        <div class="flex items-center bg-slate-900/60 border border-slate-700 rounded-full p-1 gap-1 flex-wrap">
          <button data-tab="armor" class="tab-btn px-3 py-1 rounded-full text-sm bg-emerald-500 text-slate-900 font-semibold">–ë—Ä–æ–Ω—è</button>
          <button data-tab="weapon" class="tab-btn px-3 py-1 rounded-full text-sm text-slate-300">–û—Ä—É–∂–∏–µ</button>
          <button data-tab="tool" class="tab-btn px-3 py-1 rounded-full text-sm text-slate-300">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
          <button data-tab="inter" class="tab-btn px-3 py-1 rounded-full text-sm text-slate-300">–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ</button>
        </div>
      </div>
      <div id="tabArmor" class="space-y-2 text-sm"></div>
      <div id="tabWeapon" class="space-y-2 text-sm hidden"></div>
      <div id="tabTool" class="space-y-2 text-sm hidden"></div>
      <div id="tabInter" class="space-y-2 text-sm hidden"></div>
    </section>

    <section class="glass rounded-2xl p-6 space-y-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="uppercase text-xs tracking-[0.3em] text-slate-400">–ë–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã</p>
          <h2 class="text-xl font-semibold">–¶–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
          <p class="text-sm text-slate-300">–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö.</p>
        </div>
      </div>
      <div id="baseCards" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </section>
  </div>

  <script>
    const baseResourceData = {
      '–ñ–µ–ª–µ–∑–Ω–∞—è —Ä—É–¥–∞': 1,
      '–ó–æ–ª–æ—Ç–∞ —Ä—É–¥–∞': 5,
      '–£–≥–æ–ª—å': 0.5,
      '–î–æ—Å–∫–∏': 0.5,
      '–ö–æ–∂–∞': 3,
      '–¢–∫–∞–Ω—å': 1,
      '–≠–±–æ–Ω–∏—Ç–æ–≤–∞—è —Ä—É–¥–∞': 30,
      '–§–æ—Ä—Å—Ç–æ—É–Ω–æ–≤–∞—è —Ä—É–¥–∞': 30,
      '–ì–ª–∏–Ω–∞': 1,
    };

    const recipes = {
      '–£–≥–æ–ª—å': { ingredients: { '–î–æ—Å–∫–∏': 1 } },
      '–°—ã—Ä–∞—è –≥–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': { ingredients: { '–ì–ª–∏–Ω–∞': 2 } },
      '–ì–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': { ingredients: { '–°—ã—Ä–∞—è –≥–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': 0.1, '–£–≥–æ–ª—å': 0.1 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è —Ä—É–¥–∞': 1, '–ì–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': 1, '–£–≥–æ–ª—å': 1 } },
      '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 4, '–ì–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': 1, '–£–≥–æ–ª—å': 1 } },
      '–ó–æ–ª–æ—Ç–æ–π —Å–ª–∏—Ç–æ–∫': { ingredients: { '–ó–æ–ª–æ—Ç–∞ —Ä—É–¥–∞': 2, '–ì–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': 1, '–£–≥–æ–ª—å': 1 } },
      '–ö–∞–º–µ–Ω–Ω—ã–π –∫–∏—Ä–ø–∏—á': { ingredients: { '–ì–ª–∏–Ω–∞': 5, '–£–≥–æ–ª—å': 1 } },
      '–≠–±–æ–Ω–∏—Ç–æ–≤—ã–π —Å–ª–∏—Ç–æ–∫': { ingredients: { '–≠–±–æ–Ω–∏—Ç–æ–≤–∞—è —Ä—É–¥–∞': 1, '–ì–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': 1, '–£–≥–æ–ª—å': 1 } },
      '–§–æ—Ä—Å—Ç–æ—É–Ω–æ–≤—ã–π —Å–ª–∏—Ç–æ–∫': { ingredients: { '–§–æ—Ä—Å—Ç–æ—É–Ω–æ–≤–∞—è —Ä—É–¥–∞': 1, '–ì–ª–∏–Ω—è–Ω–∞—è —Ñ–æ—Ä–º–æ—á–∫–∞': 1, '–£–≥–æ–ª—å': 1 } },
      '–ü–æ—Ä–æ—Ö': { ingredients: { '–î–æ—Å–∫–∏': 1, '–£–≥–æ–ª—å': 1 } },
      '–®–µ—Å—Ç–µ—Ä–Ω—è': { ingredients: { '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 1, '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 1 } },
      '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 3 } },
      '–ö–æ–∂–∞–Ω—ã–π —Ä–µ–º–µ—à–æ–∫': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 1, '–ö–æ–∂–∞': 2 } },
      '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 4 } },
      '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 1 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 2 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π –Ω–∞–ø–ª–µ—á–Ω–∏–∫': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 2, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 3 } },
    };

    const armorItems = {
      '–®–ª–µ–º': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 1, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 5, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 1 } },
      '–°–µ–≤–µ—Ä–Ω—ã–π —à–ª–µ–º': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 1, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 2, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 1, '–ö–æ–∂–∞': 1 } },
      '–ü–µ—Ä—á–∞—Ç–∫–∏': { ingredients: { '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 6, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 1 } },
      '–°–µ–≤–µ—Ä–Ω—ã–µ –ø–µ—Ä—á–∞—Ç–∫–∏': { ingredients: { '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 5, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 1, '–ö–æ–∂–∞': 2 } },
      '–õ–µ–≥–∫–∞—è –ö–æ–ª—å—á—É–≥–∞': { ingredients: { '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': 3 } },
      '–ö–æ–ª—å—á—É–≥–∞': { ingredients: { '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': 4, '–ö–æ–∂–∞–Ω—ã–π —Ä–µ–º–µ—à–æ–∫': 1, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 1 } },
      '–õ–µ–≥–∫–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –∫–∏—Ä–∞—Å–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 3, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 2, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 5, '–¢–∫–∞–Ω—å': 3 } },
      '–°–µ–≤–µ—Ä–Ω–∞—è –±—Ä–æ–Ω—è': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 5, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 3, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 6, '–ö–æ–∂–∞': 3 } },
      '–ñ–µ–ª–µ–∑–Ω–∞—è –∫–∏—Ä–∞—Å–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 6, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 3, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 6 } },
      '–ë—Ä–∏–≥–∞–Ω—Ç–∏–Ω–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 4, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 8, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 18, '–ö–æ–∂–∞–Ω—ã–π —Ä–µ–º–µ—à–æ–∫': 4, '–¢–∫–∞–Ω—å': 6 } },
      '–ñ–µ–ª–µ–∑–Ω–∞—è –±—Ä–æ–Ω—è –≥–æ–±–ª–∏–Ω–æ–≤': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 1, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 10, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 9, '–ö–æ–∂–∞–Ω—ã–π —Ä–µ–º–µ—à–æ–∫': 1, '–ñ–µ–ª–µ–∑–Ω—ã–π –Ω–∞–ø–ª–µ—á–Ω–∏–∫': 2, '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': 5 } },
      '–ü–ª–∞—Å—Ç–∏–Ω—á–∞—Ç–∞—è –±—Ä–æ–Ω—è': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 1, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 8, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 21, '–ñ–µ–ª–µ–∑–Ω—ã–π –Ω–∞–ø–ª–µ—á–Ω–∏–∫': 2, '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': 3, '–ö–æ–∂–∞–Ω—ã–π —Ä–µ–º–µ—à–æ–∫': 1 } },
      '–ñ–µ–ª–µ–∑–Ω–∞—è –±—Ä–æ–Ω—è': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 5, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 12, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 14, '–ñ–µ–ª–µ–∑–Ω—ã–π –Ω–∞–ø–ª–µ—á–Ω–∏–∫': 2, '–ö–æ–∂–∞–Ω—ã–π —Ä–µ–º–µ—à–æ–∫': 2, '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': 7, '–¢–∫–∞–Ω—å': 8 } },
      '–õ–∞—Ç–Ω–∞—è –ë—Ä–æ–Ω—è': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 16, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 15, '–ú–∞–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 12, '–ñ–µ–ª–µ–∑–Ω—ã–π –Ω–∞–ø–ª–µ—á–Ω–∏–∫': 2, '–ö–æ–∂–∞–Ω—ã–π —Ä–µ–º–µ—à–æ–∫': 2, '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': 9, '–¢–∫–∞–Ω—å': 12 } },
      '–≠–±–æ–Ω–∏—Ç–æ–≤—ã–π —à–ª–µ–º': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 5, '–≠–±–æ–Ω–∏—Ç–æ–≤—ã–π —Å–ª–∏—Ç–æ–∫': 4, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 2 } },
      '–≠–±–æ–Ω–∏—Ç–æ–≤–∞—è –±—Ä–æ–Ω—è': { ingredients: { '–ñ–µ–ª–µ–∑–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞': 12, '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 4, '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 10, '–ö–æ–ª—å—á—É–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ': 2, '–ñ–µ–ª–µ–∑–Ω—ã–π –Ω–∞–ø–ª–µ—á–Ω–∏–∫': 2, '–≠–±–æ–Ω–∏—Ç–æ–≤—ã–π —Å–ª–∏—Ç–æ–∫': 12 } },
      '–≠–±–æ–Ω–∏—Ç–æ–≤—ã–µ —Å–∞–ø–æ–≥–∏': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–µ –∑–∞–∫–ª–µ–ø–∫–∏': 1, '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 2, '–≠–±–æ–Ω–∏—Ç–æ–≤—ã–π —Å–ª–∏—Ç–æ–∫': 2 } },
    };

    const weaponItems = {
      '–ñ–µ–ª–µ–∑–Ω–æ–µ –∫–æ–ø—å–µ': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 14, '–î–æ—Å–∫–∏': 8 } },
      '–°—Ç–∞–ª—å–Ω–æ–µ –∫–æ–ø—å–µ': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 12, '–î–æ—Å–∫–∏': 8 } },
      '–°—É–ª–∏—Ü–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 12, '–î–æ—Å–∫–∏': 6 } },
      '–ü–∏–ª—É–º': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 12, '–î–æ—Å–∫–∏': 6 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π –∫–∏–Ω–∂–∞–ª': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 3, '–î–æ—Å–∫–∏': 1 } },
      '–°—Ç–∞–ª—å–Ω–æ–π –∫–∏–Ω–∂–∞–ª': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 3, '–î–æ—Å–∫–∏': 1 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π –¥–ª–∏–Ω–Ω—ã–π –º–µ—á': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 8, '–î–æ—Å–∫–∏': 7 } },
      '–°—Ç–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω–Ω—ã–π –º–µ—á': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 8, '–î–æ—Å–∫–∏': 7 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π –∫–æ—Ä–æ—Ç–∫–∏–π –º–µ—á': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 7, '–î–æ—Å–∫–∏': 7 } },
      '–°—Ç–∞–ª—å–Ω–æ–π –∫–æ—Ä–æ—Ç–∫–∏–π –º–µ—á': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 7, '–î–æ—Å–∫–∏': 7 } },
      '–°–∞–±–ª—è': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 11, '–î–æ—Å–∫–∏': 7 } },
      '–°—Ç–∞–ª—å–Ω–∞—è —Å–∞–±–ª—è': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 9, '–î–æ—Å–∫–∏': 7 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π –∫–ª–µ–π–º–æ—Ä': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 32, '–î–æ—Å–∫–∏': 6 } },
      '–°—Ç–∞–ª—å–Ω–æ–π –∫–ª–µ–π–º–æ—Ä': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 26, '–î–æ—Å–∫–∏': 6 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π —Ü–≤–∞–π—Ö–µ–Ω–¥–µ—Ä': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 32, '–î–æ—Å–∫–∏': 6 } },
      '–°—Ç–∞–ª—å–Ω–æ–π —Ü–≤–∞–π—Ö–µ–Ω–¥–µ—Ä': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 26, '–î–æ—Å–∫–∏': 6 } },
      '–ñ–µ–ª–µ–∑–Ω–∞—è –±—É–ª–∞–≤–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 18, '–î–æ—Å–∫–∏': 5 } },
      '–°—Ç–∞–ª—å–Ω–∞—è –±—É–ª–∞–≤–∞': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 14, '–î–æ—Å–∫–∏': 5 } },
      '–ü–∞–ª–∏—Ü–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 23, '–î–æ—Å–∫–∏': 6 } },
      '–°—Ç–∞–ª—å–Ω–∞—è –ø–∞–ª–∏—Ü–∞': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 15, '–î–æ—Å–∫–∏': 6 } },
      '–ñ–µ–ª–µ–∑–Ω–∞—è –∞–ª–µ–±–∞—Ä–¥–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 35, '–î–æ—Å–∫–∏': 12 } },
      '–°—Ç–∞–ª—å–Ω–∞—è –∞–ª–µ–±–∞—Ä–¥–∞': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 27, '–î–æ—Å–∫–∏': 12 } },
      '–¢—è–∂–µ–ª–∞—è –±—É–ª–∞–≤–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 28, '–î–æ—Å–∫–∏': 7 } },
      '–°—Ç–∞–ª—å–Ω–∞—è —Ç—è–∂–µ–ª–∞—è –±—É–ª–∞–≤–∞': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 18, '–î–æ—Å–∫–∏': 7 } },
      '–ñ–µ–ª–µ–∑–Ω–∞—è —Å–µ–∫–∏—Ä–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 27, '–î–æ—Å–∫–∏': 12 } },
      '–°—Ç–∞–ª—å–Ω–∞—è —Å–µ–∫–∏—Ä–∞': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 27, '–î–æ—Å–∫–∏': 25 } },
      '–ñ–µ–ª–µ–∑–Ω—ã–π –º–æ–ª–æ—Ç': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 29, '–î–æ—Å–∫–∏': 17 } },
      '–°—Ç–∞–ª—å–Ω–æ–π –º–æ–ª–æ—Ç': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 18, '–î–æ—Å–∫–∏': 17 } },
      '–ö–∞–≤–∞–ª–µ—Ä–∏–π—Å–∫–∞—è –ø–∏–∫–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 14, '–î–æ—Å–∫–∏': 12 } },
    };

    const toolItems = {
      '–ö–∏—Ä–∫–∞': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 6, '–î–æ—Å–∫–∏': 3 } },
      '–°—Ç–∞–ª—å–Ω–∞—è –∫–∏—Ä–∫–∞': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 6, '–î–æ—Å–∫–∏': 4 } },
      '–§–æ—Ä—Å—Ç–æ—É–Ω–æ–≤–∞—è –∫–∏—Ä–∫–∞': { ingredients: { '–ó–æ–ª–æ—Ç–æ–π —Å–ª–∏—Ç–æ–∫': 8, '–§–æ—Ä—Å—Ç–æ—É–Ω–æ–≤—ã–π —Å–ª–∏—Ç–æ–∫': 5 } },
      '–≠–±–æ–Ω–∏—Ç–æ–≤–∞—è –∫–∏—Ä–∫–∞': { ingredients: { '–°—Ç–∞–ª—å–Ω–æ–π —Å–ª–∏—Ç–æ–∫': 8, '–≠–±–æ–Ω–∏—Ç–æ–≤—ã–π —Å–ª–∏—Ç–æ–∫': 5 } },
      '–¢–æ–ø–æ—Ä–∏–∫': { ingredients: { '–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫': 6, '–î–æ—Å–∫–∏': 4 } },
    };

    const cart = [];

    const fmt = (n) => (Math.round(n * 100) / 100).toLocaleString('ru-RU');
    const getReadyItems = () => ({ ...armorItems, ...weaponItems, ...toolItems });

    function renderBaseInputs() {
      const wrap = document.getElementById('baseCards');
      if (!wrap) return;
      wrap.innerHTML = '';
      Object.entries(baseResourceData).forEach(([name, cost]) => {
        const card = document.createElement('div');
        card.className = 'glass border border-slate-700 rounded-xl p-4 flex flex-col gap-2 shadow';
        card.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="font-semibold text-white">${name}</div>
            <span class="text-xs text-slate-400">–ë–∞–∑–∞</span>
          </div>
          <label class="text-xs text-slate-300">–¶–µ–Ω–∞ –∑–∞ 1, —Ä–µ–≤–µ–Ω—Ç—ã</label>
          <div class="flex items-center gap-2">
            <input data-name="${name}" type="number" step="0.1" min="0" value="${cost}" class="w-full bg-slate-900/60 border border-slate-700 rounded px-2 py-2 text-white text-sm">
            <span class="text-xs text-slate-400">—Ä–µ–≤.</span>
          </div>`;
        card.querySelector('input').addEventListener('input', (e) => {
          const v = parseFloat(e.target.value || '0');
          baseResourceData[name] = isNaN(v) ? 0 : v;
          updateAll();
        });
        wrap.appendChild(card);
      });
    }

    function renderReadyTable(targetId, data) {
      const target = document.getElementById(targetId);
      target.innerHTML = '';
      const tableWrap = document.createElement('div');
      tableWrap.className = 'overflow-x-auto glass rounded-xl border border-slate-700';
      tableWrap.innerHTML = `
        <table class="min-w-full text-sm">
          <thead class="bg-slate-900/60 text-slate-300">
            <tr>
              <th class="text-left px-4 py-2 font-semibold">–ü—Ä–µ–¥–º–µ—Ç</th>
              <th class="text-left px-4 py-2 font-semibold">–°–æ—Å—Ç–∞–≤</th>
              <th class="text-left px-4 py-2 font-semibold w-40">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
              <th class="text-left px-4 py-2 font-semibold w-32"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>`;
      const tbody = tableWrap.querySelector('tbody');
      Object.entries(data).forEach(([name, info]) => {
        const ing = Object.entries(info.ingredients).map(([n, c]) => `${c}√ó ${n}`).join(', ');
        const { baseCost } = computeRequirements(name, 1);
        const row = document.createElement('tr');
        row.className = 'border-b border-slate-800/60 last:border-0';
        row.innerHTML = `
          <td class="px-4 py-2 font-semibold">${name}</td>
          <td class="px-4 py-2 text-slate-300">${ing}</td>
          <td class="px-4 py-2 text-emerald-300 font-semibold">${fmt(baseCost)} —Ä–µ–≤.</td>
          <td class="px-4 py-2">
            <button data-name="${name}" class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 rounded px-3 py-1 text-sm">–í –∫–æ—Ä–∑–∏–Ω—É</button>
          </td>`;
        row.querySelector('button').addEventListener('click', () => addItem(name, 1));
        tbody.appendChild(row);
      });
      target.appendChild(tableWrap);
    }

    function renderInterTable() {
      const interList = document.getElementById('tabInter');
      interList.innerHTML = '';
      const interTableWrap = document.createElement('div');
      interTableWrap.className = 'overflow-x-auto glass rounded-xl border border-slate-700';
      interTableWrap.innerHTML = `
        <table class="min-w-full text-sm">
          <thead class="bg-slate-900/60 text-slate-300">
            <tr>
              <th class="text-left px-4 py-2 font-semibold">–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ä–µ—Å—É—Ä—Å</th>
              <th class="text-left px-4 py-2 font-semibold">–°–æ—Å—Ç–∞–≤</th>
              <th class="text-left px-4 py-2 font-semibold w-40">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>`;
      const interTbody = interTableWrap.querySelector('tbody');
      Object.entries(recipes).forEach(([name, data]) => {
        const ing = Object.entries(data.ingredients).map(([n, c]) => `${c}√ó ${n}`).join(', ');
        const { baseCost } = computeRequirements(name, 1);
        const row = document.createElement('tr');
        row.className = 'border-b border-slate-800/60 last:border-0';
        row.innerHTML = `
          <td class="px-4 py-2 font-semibold">${name}</td>
          <td class="px-4 py-2 text-slate-300">${ing}</td>
          <td class="px-4 py-2 text-emerald-300 font-semibold">${fmt(baseCost)} —Ä–µ–≤.</td>`;
        interTbody.appendChild(row);
      });
      interList.appendChild(interTableWrap);
    }

    function renderLists() {
      renderBaseInputs();
      renderReadyTable('tabArmor', armorItems);
      renderReadyTable('tabWeapon', weaponItems);
      renderReadyTable('tabTool', toolItems);
      renderInterTable();
    }

    function computeRequirements(itemName, qty = 1) {
      const base = {};
      const inter = {};
      function add(obj, k, v) { obj[k] = (obj[k] || 0) + v; }
      function expand(name, count) {
        if (baseResourceData[name] !== undefined) {
          add(base, name, count);
          return;
        }
        if (recipes[name]) {
          add(inter, name, count);
          Object.entries(recipes[name].ingredients).forEach(([n, c]) => expand(n, c * count));
          return;
        }
        const ready = getReadyItems();
        if (ready[name]) {
          Object.entries(ready[name].ingredients).forEach(([n, c]) => expand(n, c * count));
          return;
        }
        console.warn('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å', name);
      }
      const ready = getReadyItems();
      Object.entries((ready[itemName] || recipes[itemName])?.ingredients || {}).forEach(([n, c]) => expand(n, c * qty));
      const baseCost = Object.entries(base).reduce((sum, [n, c]) => sum + c * (baseResourceData[n] || 0), 0);
      return { base, inter, baseCost };
    }

    function addItem(name, qty) {
      qty = Math.max(1, parseInt(qty, 10) || 1);
      const existing = cart.find((c) => c.name === name);
      if (existing) existing.qty += qty; else cart.push({ name, qty });
      renderCart();
    }

    function renderAddCards(search = '', category = 'all') {
      const container = document.getElementById('addCards');
      if (!container) return;
      container.innerHTML = '';
      const ready = getReadyItems();
      const entries = Object.entries(ready).filter(([n]) => n.toLowerCase().includes(search.toLowerCase()))
        .filter(([n]) => {
          if (category === 'all') return true;
          if (category === 'armor') return armorItems[n];
          if (category === 'weapon') return weaponItems[n];
          if (category === 'tool') return toolItems[n];
          return true;
        });
      if (!entries.length) {
        const empty = document.createElement('div');
        empty.className = 'text-slate-400 text-sm col-span-full';
        empty.textContent = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
        container.appendChild(empty);
        return;
      }
      entries.forEach(([name, info]) => {
        const { baseCost } = computeRequirements(name, 1);
        const ing = Object.entries(info.ingredients).map(([n, c]) => `${c}√ó ${n}`).join(', ');
        const card = document.createElement('div');
        card.className = 'glass border border-slate-700 rounded-xl p-4 flex flex-col gap-3 shadow';
        card.innerHTML = `
          <div>
            <div class="font-semibold text-white">${name}</div>
            <div class="text-xs text-slate-400 mt-1">${ing}</div>
          </div>
          <div class="flex items-center justify-between text-sm">
            <span class="text-emerald-300 font-semibold">${fmt(baseCost)} —Ä–µ–≤.</span>
            <div class="flex items-center gap-2">
              <input type="number" min="1" value="1" class="w-16 bg-slate-900/60 border border-slate-700 rounded px-2 py-1 text-sm text-white" />
              <button class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 rounded px-3 py-1 text-sm">–í –∫–æ—Ä–∑–∏–Ω—É</button>
            </div>
          </div>`;
        const qtyInput = card.querySelector('input');
        card.querySelector('button').addEventListener('click', () => {
          addItem(name, qtyInput.value);
          qtyInput.value = 1;
        });
        container.appendChild(card);
      });
    }

    function renderCart() {
      const list = document.getElementById('cartList');
      list.innerHTML = '';
      if (!cart.length) {
        list.innerHTML = '<p class="text-slate-400 text-sm">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã.</p>';
      }
      cart.forEach((item, idx) => {
        const { baseCost } = computeRequirements(item.name, item.qty);
        const line = document.createElement('div');
        line.className = 'glass border border-slate-700 rounded-lg p-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3';
        line.innerHTML = `
          <div>
            <div class="font-semibold">${item.name}</div>
            <div class="text-xs text-slate-400">–ö–æ–ª-–≤–æ: <input type="number" min="1" value="${item.qty}" class="w-16 bg-slate-900/60 border border-slate-700 rounded px-2 py-1 text-sm"> ¬∑ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: ${fmt(baseCost)} —Ä–µ–≤.</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="bg-slate-700 hover:bg-slate-600 rounded px-3 py-1 text-sm" data-act="dup">+1</button>
            <button class="bg-red-500/80 hover:bg-red-500 rounded px-3 py-1 text-sm" data-act="del">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        `;
        const qtyInput = line.querySelector('input');
        qtyInput.addEventListener('input', (e) => {
          const v = Math.max(1, parseInt(e.target.value, 10) || 1);
          cart[idx].qty = v; renderCart();
        });
        line.querySelector('[data-act="dup"]').addEventListener('click', () => { cart[idx].qty += 1; renderCart(); });
        line.querySelector('[data-act="del"]').addEventListener('click', () => { cart.splice(idx, 1); renderCart(); });
        list.appendChild(line);
      });
      updateTotals();
    }

    function mergeTotals() {
      const baseTotals = {};
      const interTotals = {};
      let baseCostSum = 0;
      cart.forEach((entry) => {
        const { base, inter, baseCost } = computeRequirements(entry.name, entry.qty);
        baseCostSum += baseCost;
        Object.entries(base).forEach(([n, c]) => { baseTotals[n] = (baseTotals[n] || 0) + c; });
        Object.entries(inter).forEach(([n, c]) => { interTotals[n] = (interTotals[n] || 0) + c; });
      });
      return { baseTotals, interTotals, baseCostSum };
    }

    function isRoundUp() {
      const cb = document.getElementById('roundUpToggle');
      return cb ? cb.checked : true;
    }

    function updateTotals() {
      const { baseTotals, interTotals, baseCostSum } = mergeTotals();
      const markup = getMarkup();
      let finalCost = baseCostSum * (1 + markup / 100);
      if (isRoundUp()) finalCost = Math.ceil(finalCost);
      document.getElementById('baseCost').textContent = `${fmt(baseCostSum)} —Ä–µ–≤.`;
      document.getElementById('markupInfo').textContent = `+${fmt(markup)}%`;
      document.getElementById('finalCost').textContent = `${fmt(finalCost)} —Ä–µ–≤.`;

      const baseWrap = document.getElementById('baseSummary');
      baseWrap.innerHTML = '';
      if (!Object.keys(baseTotals).length) {
        baseWrap.innerHTML = '<p class="text-slate-500 text-sm">‚Äî</p>';
      } else {
        const table = document.createElement('div');
        table.className = 'overflow-x-auto glass rounded-lg border border-slate-800/60';
        table.innerHTML = `
          <table class="min-w-full text-sm">
            <thead class="bg-slate-900/60 text-slate-300">
              <tr>
                <th class="text-left px-4 py-2 font-semibold">–†–µ—Å—É—Ä—Å</th>
                <th class="text-left px-4 py-2 font-semibold w-24">–ö–æ–ª-–≤–æ</th>
                <th class="text-left px-4 py-2 font-semibold w-32">–°—É–º–º–∞, —Ä–µ–≤.</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>`;
        const tbody = table.querySelector('tbody');
        Object.entries(baseTotals).forEach(([n, c]) => {
          const cost = c * (baseResourceData[n] || 0);
          const row = document.createElement('tr');
          row.className = 'border-b border-slate-800/60 last:border-0';
          row.innerHTML = `
            <td class="px-4 py-2">${n}</td>
            <td class="px-4 py-2 text-slate-200">${fmt(c)} —à—Ç</td>
            <td class="px-4 py-2 text-emerald-300 font-semibold">${fmt(cost)} —Ä–µ–≤.</td>`;
          tbody.appendChild(row);
        });
        baseWrap.appendChild(table);
      }

      const interWrap = document.getElementById('interSummary');
      interWrap.innerHTML = '';
      if (!Object.keys(interTotals).length) {
        interWrap.innerHTML = '<p class="text-slate-500 text-sm">‚Äî</p>';
      } else {
        const table = document.createElement('div');
        table.className = 'overflow-x-auto glass rounded-lg border border-slate-800/60';
        table.innerHTML = `
          <table class="min-w-full text-sm">
            <thead class="bg-slate-900/60 text-slate-300">
              <tr>
                <th class="text-left px-4 py-2 font-semibold">–†–µ—Å—É—Ä—Å</th>
                <th class="text-left px-4 py-2 font-semibold w-24">–ö–æ–ª-–≤–æ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>`;
        const tbody = table.querySelector('tbody');
        Object.entries(interTotals).forEach(([n, c]) => {
          const row = document.createElement('tr');
          row.className = 'border-b border-slate-800/60 last:border-0';
          row.innerHTML = `
            <td class="px-4 py-2">${n}</td>
            <td class="px-4 py-2 text-slate-200">${fmt(c)} —à—Ç</td>`;
          tbody.appendChild(row);
        });
        interWrap.appendChild(table);
      }
    }

    function getMarkup() {
      const v = parseFloat(document.getElementById('markupValue').value || '0');
      return isNaN(v) ? 0 : v;
    }

    function bindMarkup() {
      const range = document.getElementById('markupInput');
      const num = document.getElementById('markupValue');
      const sync = (v) => { v = Math.max(0, Math.min(500, v)); range.value = v; num.value = v; updateTotals(); };
      range.addEventListener('input', (e) => sync(parseFloat(e.target.value)));
      num.addEventListener('input', (e) => sync(parseFloat(e.target.value)));
    }

    function bindRoundToggle() {
      const cb = document.getElementById('roundUpToggle');
      if (!cb) return;
      cb.addEventListener('change', updateTotals);
    }

    function bindTabs() {
      const buttons = document.querySelectorAll('.tab-btn');
      const containers = {
        armor: document.getElementById('tabArmor'),
        weapon: document.getElementById('tabWeapon'),
        tool: document.getElementById('tabTool'),
        inter: document.getElementById('tabInter'),
      };
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          buttons.forEach((b) => b.classList.remove('bg-emerald-500', 'text-slate-900', 'font-semibold'));
          btn.classList.add('bg-emerald-500', 'text-slate-900', 'font-semibold');
          Object.values(containers).forEach((c) => c.classList.add('hidden'));
          const tab = btn.dataset.tab;
          containers[tab]?.classList.remove('hidden');
        });
      });
    }

    function parseIngredients(text) {
      const result = {};
      const lines = (text || '').split(/\n+/);
      lines.forEach((raw) => {
        const line = raw.trim();
        if (!line) return;
        let name = '';
        let qty = 1;
        const firstNum = line.match(/^([\d.,]+)\s*[x—Ö]?\s*(.+)$/i);
        if (firstNum) {
          qty = parseFloat(firstNum[1].replace(',', '.')) || 1;
          name = firstNum[2].trim();
        } else if (line.includes(':')) {
          const [n, q] = line.split(':');
          name = n.trim();
          qty = parseFloat((q || '').replace(',', '.')) || 1;
        } else if (line.match(/^(.+?)\s*[=]\s*([\d.,]+)$/)) {
          const m = line.match(/^(.+?)\s*[=]\s*([\d.,]+)$/);
          name = (m?.[1] || '').trim();
          qty = parseFloat((m?.[2] || '').replace(',', '.')) || 1;
        } else if (line.match(/^(.+?)\s+([\d.,]+)$/)) {
          const m = line.match(/^(.+?)\s+([\d.,]+)$/);
          name = (m?.[1] || '').trim();
          qty = parseFloat((m?.[2] || '').replace(',', '.')) || 1;
        } else {
          name = line;
          qty = 1;
        }
        if (!name) return;
        result[name] = (result[name] || 0) + qty;
      });
      return result;
    }

    function bindRecipeAdder() {
      const btn = document.getElementById('addRecipeBtn');
      const msg = document.getElementById('recipeMsg');
      if (!btn) return;
      btn.addEventListener('click', () => {
        const type = document.getElementById('recipeType').value;
        const name = (document.getElementById('recipeName').value || '').trim();
        const ingText = document.getElementById('recipeIngredients').value;
        const ings = parseIngredients(ingText);
        if (!name) {
          msg.textContent = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞';
          msg.className = 'text-xs text-red-400';
          return;
        }
        if (!Object.keys(ings).length) {
          msg.textContent = '–î–æ–±–∞–≤—å—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã (–ø–æ —Å—Ç—Ä–æ–∫–∞–º)';
          msg.className = 'text-xs text-red-400';
          return;
        }
        if (type === 'inter') {
          recipes[name] = { ingredients: ings };
        } else if (type === 'armor') {
          armorItems[name] = { ingredients: ings };
        } else if (type === 'weapon') {
          weaponItems[name] = { ingredients: ings };
        } else if (type === 'tool') {
          toolItems[name] = { ingredients: ings };
        }
        msg.textContent = `–†–µ—Ü–µ–ø—Ç ¬´${name}¬ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ ${type === 'inter' ? '–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö' : type === 'armor' ? '–±—Ä–æ–Ω–µ' : type === 'weapon' ? '–æ—Ä—É–∂–∏–∏' : '–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö'}!`;
        msg.className = 'text-xs text-emerald-400';
        document.getElementById('recipeName').value = '';
        document.getElementById('recipeIngredients').value = '';
        renderLists();
        const currentSearch = document.getElementById('addSearch')?.value || '';
        renderAddCards(currentSearch);
        renderCart();
      });
    }

    function bindSearchCards() {
      const input = document.getElementById('addSearch');
      if (!input) return;
      input.addEventListener('input', (e) => {
        renderAddCards(e.target.value, currentAddCategory);
      });
    }

    function updateAll() {
      renderLists();
      const currentSearch = document.getElementById('addSearch')?.value || '';
      renderAddCards(currentSearch, currentAddCategory);
      renderCart();
      updateTotals();
    }

    let currentAddCategory = 'all';

    function bindAddCategory() {
      const buttons = document.querySelectorAll('.add-cat-btn');
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          buttons.forEach((b) => b.classList.remove('bg-emerald-500', 'text-slate-900', 'font-semibold'));
          buttons.forEach((b) => b.classList.add('bg-slate-800/70', 'text-slate-300'));
          btn.classList.add('bg-emerald-500', 'text-slate-900', 'font-semibold');
          btn.classList.remove('bg-slate-800/70', 'text-slate-300');
          currentAddCategory = btn.dataset.addcat || 'all';
          const currentSearch = document.getElementById('addSearch')?.value || '';
          renderAddCards(currentSearch, currentAddCategory);
        });
      });
    }

    function init() {
      renderLists();
      renderAddCards('', currentAddCategory);
      bindMarkup();
      bindRoundToggle();
      bindTabs();
      bindRecipeAdder();
      bindSearchCards();
      bindAddCategory();
      renderCart();
    }

    init();
  </script>
</body>
</html>
